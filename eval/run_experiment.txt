#!/bin/bash
# Settings:
# choose if filmed, simulated, or both
dir=(20-11-3-sim) 	#Which dir?	Ex: (20-04-09 20-11-3-sim)
nmbrs=(18)		#Which sets?	Ex: (18 23 27 28)
experiments=(hh)	#Which exps?	Ex: (hh hm hl mh lh)

#Occlusion settings:
fallbackperiod=40
azipeperiod=20




# This execution script runs positioning algorithm on all datasets and outputs
# the log files in their corresponding directories

# Check that pwd is correct
echo "Testing if we are at the right directory by running without argument..."
var=$(bin/positioning.out)

if [ -z "$var" ]; then
	echo ---Script must be executed from working directory Robust-Positioning--
	exit
fi
echo "Success! Ignore row above."

if [[ $# -eq 0 ]];then
echo "Must give either VO or MARTON as argument"
exit
fi

if [ "$1" != "VO" ] && [ "$1" != "MARTON" ]; then
echo "Argument must be either VO or MARTON"
exit
fi


echo ""
echo "=======TOTAL TEST MATRIX======"
echo "|  \complex.|    |     |     |"
echo "|fps\_______|_Lo_|_Mid_|_Hi__|"	
echo "|    1/1    | hl | hm  | hh  |"
echo "|    1/2    |    |     | mh  |"
echo "|    1/4    |    |     | lh  |"


#Calculate amount of experiments and print some info
numOfDirs="${#dir[@]}"
numOfSets="${#nmbrs[@]}"
numOfExp="${#experiments[@]}"
totnmbr=$(($numOfExp*$numOfSets*$numOfDirs))
echo "Executing $numOfExp configurations on $(($numOfSets*$numOfDirs)) datasets = $totnmbr experiments"
echo "The following experiments will be executed:"
echo "Directories: ${dir[@]}"
echo "Datasets: ${nmbrs[@]}"
echo "Setups: ${experiments[@]}"
echo "=== Starting evaluations..."
counter=0
for directory in ${dir[@]};do
	for number in ${nmbrs[@]};do
		for experiment in ${experiments[@]};do	
			percent=$((100*$counter/$totnmbr))
			echo -e "Total progress: $percent% Evaluation $directory / $number / $experiment...\r\c"



posalg=$1
#Default values
fallbackperiod=40
azipeperiod=20
martonbuffersize=5
occlude=false
frameratediv=1
fileending=$experiment"_log.csv"
filename=$posalg"_"$fileending

case $experiment in
  hl)
echo HL
    ;;

  hm)
echo HM
    ;;

  hh)
echo HH
martonbuffersize=5
occlude=false
frameratediv=1
    ;;
  mh)
echo MH
    ;;
  lh)
echo LH
    ;;

  *)
    echo "INVALID SETUP"
	exit
    ;;
esac	



silence=$(bin/positioning.out --file ../../../Evaluation/$directory/20-04-09-$number/exampleConfig.txt \
--OUT $fileending --POS_ALG $posalg --OCCLUDE $occlude --FRAMERATE_DIV $frameratediv \
--MARTON_CONEWEIGHT 2 --FALLBACK_PERIOD $fallbackperiod --AZIPE_PERIOD $azipeperiod \
--MARTON_BUFFERSIZE $martonbuffersize)

echo -e "Copying result file of  $directory / $number / $experiment to git repo... \c"
cp ../../../Evaluation/$directory/20-04-09-$number/$filename eval/data/$directory/20-04-09-$number/$filename 
echo Done!


			((counter+=1))
			sleep 1
		done
	done
done
percent=$((100*$counter/$totnmbr))
echo "Total progress: $percent%"

echo "DONE!"
exit

